<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Alessio's Portofolio</title>
        <style>
            * {
                padding: 0px;
                margin: 0px;
            }
        </style>
    </head>
    <body>
        <script>
            let defaultWorldSize = 9602;
            let defaultPlayerSize = 75;
            let defaultPlayerSpeed = 8;
            let enablePlayerControl = false;
            let tickId = null;

            class Player {
                constructor(posX, posY, size, speed, map) {
                    this.ctx = map.getContext("2d");
                    this.ctx.fillStyle = "blue";

                    this.speed = speed;
                    this.size = size;
                    this.posX = posX - this.size / 2;
                    this.posY = posY - this.size / 2;
                    this.sollX = this.posX;
                    this.sollY = this.posY;
                    this.directionX = 0;
                    this.directionY = 0;
                }
                goTo(x, y) {
                    let diffX;
                    let diffY;
                    let left = false;
                    let up = false;
                    this.sollX = x;
                    this.sollY = y;

                    diffX = this.sollX - this.posX;
                    diffY = this.sollY - this.posY;

                    if (diffX < 0) {
                        diffX *= -1;
                        left = true;
                    }
                    if (diffY < 0) {
                        diffY *= -1;
                        up = true;
                    }

                    this.directionX = diffX / (diffX + diffY);
                    this.directionY = diffY / (diffX + diffY);

                    if (left) {
                        this.directionX *= -1;
                    }
                    if (up) {
                        this.directionY *= -1;
                    }

                    // console.log(`MY CURRENT POSITION IS X: ${this.posX} Y: ${this.posY}`)
                    // console.log(`YOU CLICKED AT         X: ${this.sollX} Y: ${this.sollY}`)
                    // console.log(`I NEED TO GO ${diffX} PIXELS TO THE RIGHT`)
                    // console.log(`I NEED TO GO ${diffY} PIXELS TO THE DOWN`)
                    // console.log(`I AM MOVING AT ${this.directionX} TO THE RIGHT`)
                    // console.log(`I AM MOVING AT ${this.directionY} DOWN`)
                }
                place(a, b, c, d) {
                    this.ctx.fillRect(a, b, c, d);
                }

                placeNow() {
                    this.ctx.fillRect(
                        this.posX,
                        this.posY,
                        this.size,
                        this.size
                    );
                }

                remove() {
                    this.ctx.clearRect(
                        this.posX - 1,
                        this.posY - 1,
                        this.size + 2,
                        this.size + 2
                    );
                }

                center() {
                    window.scroll({
                        top: p.posY - window.innerHeight / 2 + p.size / 2,
                        left: p.posX - window.innerWidth / 2 + p.size / 2,
                        behavior: "smooth",
                    });
                }

                checkIfArrived() {
                    let tolerance = 5;
                    if (
                        this.posX > this.sollX - tolerance &&
                        this.posX < this.sollX + tolerance &&
                        this.posY > this.sollY - tolerance &&
                        this.posY < this.sollY + tolerance
                    ) {
                        return true;
                    } else {
                        return false;
                    }
                }

                halt() {
                    this.directionX = 0;
                    this.directionY = 0;
                }

                render() {
                    if (this.checkIfArrived()) {
                        //player cant move
                    } else {
                        this.remove();

                        this.posX += this.directionX * this.speed;
                        this.posY += this.directionY * this.speed;
                        document.documentElement.scrollLeft +=
                            this.directionX * this.speed;
                        document.documentElement.scrollTop +=
                            this.directionY * this.speed;

                        this.placeNow();
                    }
                }
            }

            class OverWorld {
                constructor(size) {
                    this.map = document.createElement("canvas");
                    this.map.width = size;
                    this.map.height = size;
                    this.map.style.cssText = `
                        display: block;
                        background-color: #eee;
                        overflow: hidden;
                    `;
                    document.querySelector("body").append(this.map);
                }
            }

            class Popup {
                constructor(map) {
                    this.ctx = map.getContext("2d");
                    this.ctx.fillStyle = "red";
                    this.ctx.fillRect(1, 1, 20, 20);
                }
            }
            var ow = new OverWorld(defaultWorldSize);
            var p = new Player(
                defaultWorldSize / 2,
                defaultWorldSize / 2,
                defaultPlayerSize,
                defaultPlayerSpeed,
                ow.map
            ); //spawn player in the middle of the map
            p.placeNow();
            p.center();

            function tick() {
                p.render();
            }

            clearInterval(tickId);
            tickId = setInterval(tick, 32);

            ow.map.onclick = function (e) {
                p.goTo(
                    e.x - p.size / 2 + window.scrollX,
                    e.y - p.size / 2 + window.scrollY
                );
                // p.place(e.x - p.size / 2, e.y - p.size / 2, p.size, p.size);
                // console.log("scroll location:", window.scrollX, window.scrollY);
                // console.log("mouse location:", e.x, e.y);
            };
            document.onkeydown = function (event) {};
            ////////////////////// TODO //////////////////////
            //popup
            //gui - esc
        </script>
    </body>
</html>
